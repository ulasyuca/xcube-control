<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale = 1">
    <link rel="stylesheet" type="text/css" href="xcube.css">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.8.0/js/anychart-base.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.8.0/js/anychart-data-adapter.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">    <title>XCUBE CONTROL</title>
</head>
<body>
    <div class="scroll_enabled">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark test" role="navigation" id="xcube">
        <div class="container-fluid">
            <a class="navbar-brand ml-5" href="xcube-control.html?#"><img class="logo" alt="logo" src="https://www.x-cube.nl/wp-content/uploads/2019/11/xcube_4kant-e1574099916511.png"></a>
            <h1>XCUBE-CONTROL</h1>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div id="menu" class="collapse navbar-collapse">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown"><p class="text-light loggedInUsername" style="display: inline-block" id="loggedInUsername"></p></a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <a href="#" class="nav-link text-light" onclick="logout()">Uitloggen</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <center>
    <div class="container text-light">
        <div class="errors">
            <strong><p style="color: red; font-size: 3vh" id="error"></p></strong>
            <strong><p style="color: red; font-size: 3vh" id="errorDag"></p></strong>
        </div>
        <div class="check_delete" id="check_delete" style="display: none">
            <div class="contents">
            <p>Weet je het zeker?</p>
            <button class="btn" id="check_ja">Ja</button>
            <button class="btn red" id="check_nee">Nee</button>
            </div>
        </div>
        <a onclick="openDoor()">
            <span id="lock"><i id="lock1Class" class="fa fa-lock" aria-hidden="true"></i></span>
        </a>
        <a onclick="noodOpen()">
            <span id="lock2"><i id="lock2Class" class="fa fa-lock" aria-hidden="true"></i></span>
        </a>
        <a onclick="doorLockCheck()">
            <span id="lock3"><i id="lock3Class" class="fa fa-lock" aria-hidden="true"></i></span>
        </a>
        <form class="form1" action="#" method="get">
            <strong><p class="restart" id="text3"></p></strong>
            <strong><p class="form2" id="form"></p></strong>
            <strong><p class="deleteMSG" id="deleteMSG"></p></strong>
            <strong><p class="user" id="naamTxt"></p></strong>
            <strong><p class="user" id="emailTxt"></p></strong>
            <strong><p class="user" id="codeTxt"></p></strong>
            <h2>Voeg een persoon toe</h2>
            <div class="form-group">
            <label for="naam">Naam: </label>
            <input onkeydown="naamkeydown()" class="form-control naam" type="text" id="naam" placeholder="Naam">
            </div>
            <div class="form-group">
            <label for="email">Email: </label>
            <input onkeydown="emailkeydown()" class="form-control email" type="email" id="email" placeholder="Email"><br>
            </div>
            <label for="dag">Datum:</label>
            <select class="text-light" onclick="dagklik()" onkeydown="dagklik()" id="dag">
                <option>- Dag -</option>
                <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option>
                <option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option>
                <option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
                <option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option>
                <option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option>
                <option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option>
                <option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option>
                <option value="29">29</option><option value="30">30</option><option value="31">31</option>
            </select>
            <select class="text-light" onclick="maandklik()" onkeydown="maandklik()" id="maand">
                <option>- Maand -</option>
                <option value="Januari(1)">Januari</option>
                <option value="Februari(2)">Februari</option>
                <option value="Maart(3)">Maart</option>
                <option value="April(4)">April</option>
                <option value="Mei(5)">Mei</option>
                <option value="Juni(6)">Juni</option>
                <option value="Juli(7)">Juli</option>
                <option value="Augustus(8)">Augustus</option>
                <option value="September(9)">September</option>
                <option value="Oktober(10)">Oktober</option>
                <option value="November(11)">November</option>
                <option value="December(12)">December</option>
            </select>
            <select class="text-light" onclick="jaarklik()" onkeydown="jaarklik()" id="jaar">
                <option>- Jaar -</option>
                <!--<option value="2020">2020</option>
                <option value="2021">2021</option>-->
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <!--<option value="2025">2025</option>-->
            </select><br>
            <label for="tijdBeginH">Tijd Begin:</label>
            <input placeholder="00" class="text-light tijdBegin" onkeydown="tijdBeginHkeydown()" id="tijdBeginH" type="text">:<input placeholder="00" class="text-light tijdBegin" type="text" onkeydown="tijdBeginMkeydown()" id="tijdBeginM"><br>
            <label for="tijdEindeH">Tijd Einde:</label>
            <input placeholder="00" class="text-light tijdEinde" onkeydown="tijdEindeHkeydown()" id="tijdEindeH" type="text">:<input placeholder="00" class="text-light tijdEinde" type="text" onkeydown="tijdEindeMkeydown()" id="tijdEindeM">
            <br><br><input onclick="create()" class="btn send" type="submit" value="Verstuur">
            <input onclick="deleteUsers()" class="btn delete" type="submit" value="Verwijder"><br>
        </form>
        <form class="form1" id="formOutput" action="#" method="get">
        <h3>Zoek gebruiker</h3>
        <input type="text" class="form-control" id="name"><br>
        <div class="output">
        <p id="nameOutput"></p>
        <p id="emailOutput"></p>
        <p id="pinOutput"></p>
        <p id="dateStart"></p>
        <p id="dateEnd"></p>
        </div>
        <p id="noUser"></p>
        <input type="submit" id="searchUser" class="btn send" onclick="searchUserName()" value="Verstuur">
        <input type="button" id="deleteUser" class="btn delete" onclick="deleteSearchUser()" value="Verwijder">
        </form>
        <main>
            <input onkeydown="naamkeydown()" class="form-control inputValue" type="text" id="input_value">
            <button onclick="focusInput()">Deur openen</button>
            <p>klik hier om info te krijgen over de 2n access unit</p>
            <button class="btn" onclick="deviceInfo()">Klik Hier</button>
            <button class="btn" id="reset" onclick="reset()" style="display: none">reset</button>
            <div id="box"></div>
            <p>klik hier om de deur te openen</p>
            <button class="btn" id="open" onclick="openDoor()">Klik Hier</button>
            <div id="box3" style="display: none"></div>
            <p>klik hier om de 2n access unit te restarten</p>
            <button class="btn" onclick="deviceRestart()">Klik Hier</button>
            <div id="box4" style="display: none"></div>
            <p>Knop nooduitgang!</p>
            <button class="btn noodOpen" id="noodOpen" onclick="noodOpen()">Open</button>&nbsp&nbsp<button class="btn noodDicht" id="noodDicht" onclick="noodDicht()">Dicht</button><br>
            <div id="nood" style="display: none;"></div>
            <a href="../../xcube_trailer/index.html" id="trailer">Bekijk Trailer</a>
        </main>
    </div>
</div>  
<script type="text/javascript">
    const lock1 = document.getElementById("lock1Class");
    const lock2 = document.getElementById("lock2Class");
    const lock3 = document.getElementById("lock3Class");
    const checkDoorOpenColor = document.getElementById('lock');
    const checkDoorOpenColor2 = document.getElementById('lock2');
    const checkDoorOpenColor3 = document.getElementById('lock3');
    const nameOutput = document.getElementById('nameOutput');
    const emailOutput = document.getElementById('emailOutput');
    const pinOutput = document.getElementById('pinOutput');
    const dateStartOutput = document.getElementById('dateStart');
    const dateEndOutput = document.getElementById('dateEnd');
    const array1 = [];
    const array2 = [];
    
    let userUuid;
    let status = '';
    let password = 'Welkom2019!'//sessionStorage["wachtwoord"];
    let username = 'admin'//sessionStorage["naam"];
    let name = username+":"+password;
    let b64 = btoa(name);
    let reponse;
    let reponse2;
    let response3;
    let response4;
    let checkDoorLock;
    document.getElementById("loggedInUsername").innerHTML = username;
    window.onload = function () {
        window.location.replace('xcube-control.html?#');
        var checkDoor = window.setInterval(function(){
            const url = "https://192.168.33.10/api/switch/status";
            const xhr = new XMLHttpRequest();
            const xhr2 = new XMLHttpRequest();
            
            xhr.onload = () => {
                const data = JSON.parse(xhr.responseText);
                response = JSON.stringify(data.result.switches[0].active);
                const checkDoor = JSON.stringify(data.result.switches[0].locked);
                if (checkDoor == 'false'){
                    checkDoorLock = 'unlocked';
                    lock3.className = "fa fa-unlock";
                    checkDoorOpenColor3.style.color = 'green';
                }else{
                    checkDoorLock = 'locked';
                    lock3.className = 'fa fa-lock';
                    checkDoorOpenColor3.style.color = 'red';
                }
                if (response == 'true'){
                    lock1.className = "fa fa-unlock";
                    checkDoorOpenColor.style.color = 'green';
                }else {
                    checkDoorOpenColor.style.color = "red"; 
                    lock1.className = "fa fa-lock";
                }
                };

                xhr2.onload = () => {
                    const data2 = JSON.parse(xhr2.responseText);
                    response2 = JSON.stringify(data2.result.switches[1].active);
                    if (response2 == 'true'){
                        checkDoorOpenColor2.style.color = 'green';
                        lock2.className = "fa fa-unlock";
                    }else{
                        if (checkDoorOpenColor2.style.color == "green") {
                           checkDoorOpenColor2.style.color = "red"; 
                           lock2.className = "fa fa-lock";
                        }
                    }
                };
            xhr.open("GET", url);
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send();
            xhr2.open("GET", url);
            xhr2.setRequestHeader('Authorization', 'Basic '+b64);
            xhr2.send();
        }, 200);
        // if (sessionStorage.length === 0) {
                //     window.location.replace('index.html?#');
                // }
        };
        function focusInput() {
            document.getElementById("input_value").focus();
        }
        function doorLockCheck(){
            if (checkDoorLock == 'locked')doorUnlock();
            else doorLock();
        }
        function doorLock(){
            const url = "https://192.168.33.10/api/switch/ctrl?switch=1&action=lock";
            const xhr = new XMLHttpRequest();
            xhr.open("GET", url);
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send();
        }
        function doorUnlock(){
            const url = "https://192.168.33.10/api/switch/ctrl?switch=1&action=unlock";
            const xhr = new XMLHttpRequest();
            xhr.open("GET", url);
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send();
        }
        const input = document.getElementById('input_value');
        input.addEventListener('change', openDoor2);
        function openDoor2() {
            if (input.value === '2730616') {
                //deur openen voor 3 seconden
                const url = "https://192.168.33.10/api/switch/ctrl?switch=1&action=trigger";
                const xhr = new XMLHttpRequest();

                xhr.open("GET", url);
                xhr.setRequestHeader('Authorization', 'Basic '+b64);
                xhr.send();
                input.value = '';
            }else{
                alert('test');
                input.value = '';
            }
        }
        function logout() {
            //uitloggen en terug naar login pagina.
            sessionStorage.clear();
            window.location.replace('index.html?#');
        }
        function tijdBeginHkeydown() {
            document.getElementById("tijdBeginH").style.border = "";
        }function tijdEindeHkeydown() {
            document.getElementById("tijdEindeH").style.border = "";
        }function tijdBeginMkeydown() {
            document.getElementById("tijdBeginM").style.border = "";
        }function tijdEindeMkeydown() {
            document.getElementById("tijdEindeM").style.border = "";
        }function maandklik() {
            document.getElementById("maand").style.border = "";
        }function dagklik() {
            document.getElementById("dag").style.border = "";
        }function jaarklik() {
            document.getElementById("jaar").style.border = "";
        }function naamkeydown() {
            document.getElementById("naam").style.border = "";
        }function emailkeydown() {
            document.getElementById("email").style.border = "";
        }
        function create() {
            //user toevoegen.
            const tijdBeginH = document.getElementById("tijdBeginH").value;
            const tijdBeginM = document.getElementById("tijdBeginM").value;
            const tijdEindeH = document.getElementById("tijdEindeH").value;
            const tijdEindeM = document.getElementById("tijdEindeM").value;
            const tijdBeginSeconds = (+tijdBeginH) * 60 * 60 + (+tijdBeginM) * 60;
            const tijdEindeSeconds = (+tijdEindeH) * 60 * 60 + (+tijdEindeM) * 60;
            let jaar = document.getElementById("jaar").value;
            let maand = document.getElementById("maand").value;
            let dag = document.getElementById("dag").value;
            const dagArray = ["1577836800", "86400", "172800", "259200", "345600", "432000", "518400", "604800", "691200", "777600", "864000", "950400", "1036800", "1123200", "1209600", "1296000", "1382400", "1468800", "1555200", "1641600", "1728000", "1814400", "1900800", "1987200", "2073600", "2160000", "2246400", "2332800", "2419200", "2505600", "2592000"];
            const maandArray = ["1577836800", "2667606", "5173212", "7851618", "10443624", "13122030", "15714036", "18392402", "21070848", "23662854", "26341200", "28933206"];
            let naam = document.getElementById("naam").value;
            let email = document.getElementById("email").value;
            if (dag === "- Dag -") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                document.getElementById("dag").style.border = "2px red solid";
                status = 'fout';
            }
            if (dag !== "- Dag -") {
                document.getElementById("error").innerHTML = "";
                document.getElementById("dag").style.border = "none";
                status = 'goed';
            }
            if (maand === "- Maand -") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                document.getElementById("maand").style.border = "2px red solid";
                status = 'fout';
            }
            if (maand !== "- Maand -") {
                document.getElementById("error").innerHTML = "";
                document.getElementById("maand").style.border = "none";
                status = 'goed';
            }
            if (jaar === "- Jaar -") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                document.getElementById("jaar").style.border = "2px red solid";
                status = 'fout';
            }
            if (jaar !== "- Jaar -") {
                document.getElementById("error").innerHTML = "";
                document.getElementById("jaar").style.border = "none";
                status = 'goed';
            }
            if (tijdBeginH === "") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                document.getElementById("tijdBeginH").style.border = "2px red solid";
                status = 'fout';
            }
            if (tijdEindeH === "") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                document.getElementById("tijdEindeH").style.border = "2px red solid";
                status = 'fout';
            }
            if (tijdBeginH !== "") {
                document.getElementById("error").innerHTML = "";
                document.getElementById("tijdBeginH").style.border = "none";
                status = 'goed';
            }
            if (tijdEindeH !== "") {
                document.getElementById("error").innerHTML = "";
                document.getElementById("tijdEindeH").style.border = "none";
                status = 'goed';
            }
            if (tijdBeginM === "") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                document.getElementById("tijdBeginM").style.border = "2px red solid";
                status = 'fout';
            }
            if (tijdEindeM === "") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                document.getElementById("tijdEindeM").style.border = "2px red solid";
                status = 'goed';
            }
            if (tijdBeginM !== "") {
                document.getElementById("error").innerHTML = "";
                document.getElementById("tijdBeginM").style.border = "none";
                status = 'goed';
            }
            if (tijdEindeM !== "") {
                document.getElementById("error").innerHTML = "";
                document.getElementById("tijdEindeM").style.border = "none";
                status = 'goed';
            }
            if (jaar === "- Jaar -") {
                document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                status = 'fout';
            }
            //jaar 2020
            // if (jaar === "2020") {
            //     jaar = "1656210912";
            // }
            //jaar 2021
            //if(jaar === "2021")jaar = "1609383600";
            //jaar 2022
            if (jaar === "2022") {
                jaar = "1640919600";
            }
            //jaar 2023
            if (jaar === "2023") {
                jaar = "1672455600";
            }
            //jaar 2024
            if (jaar === "2024") {
                jaar = "1704078000";
            }
            //jaar 2025
            // if (jaar === "2025") {
            //     jaar = "1704075408";
            // }
            if (maand === "- Maand -") {
                maand = "";
            }
            if (maand === "Januari(1)") {
                jaar = maandArray[0];
                maand = "";
            }
            if (maand === "Februari(2)") if (dag === "30" || dag === "31") {
                document.getElementById("errorDag").innerHTML = "Voer een geldige dag in!";
                document.getElementById("dag").style.border = "2px red solid";
            } else {
                maand = maandArray[1];
            }
            if (maand === "Maart(3)") {
                maand = maandArray[2];
            }
            if (maand === "April(4)") {
                maand = maandArray[3];
            }
            if (maand === "Mei(5)") {
                maand = maandArray[4];
            }
            if (maand === "Juni(6)") {
                maand = maandArray[5];
            }
            if (maand === "Juli(7)") {
                maand = maandArray[6];
            }
            if (maand === "Augustus(8)") {
                maand = maandArray[7];
            }
            if (maand === "September(9)") {
                maand = maandArray[8];
            }
            if (maand === "Oktober(10)") {
                maand = maandArray[9];
            }
            if (maand === "November(11)") {
                maand = maandArray[10];
            }
            if (maand === "December(12)") {
                maand = maandArray[11];
            }
            if (dag === "- Dag -") {
                dag = "";
            }else{
                dag = dagArray[dag-1];
            }
            let beginDatum = +maand + +dag + +jaar + +tijdBeginSeconds;
            let eindDatum = +maand + +dag + +jaar + +tijdEindeSeconds;
            if (isNaN(beginDatum)) {
                console.log("Error, geen begin datum");
            } else {
                console.log(beginDatum);
            }
            if (isNaN(eindDatum)) {
                console.log("Error, geen eind datum");
            } else {
                console.log(eindDatum);
            }
            if (naam === '' || email === '') {
                if (naam === '') {
                    document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                    document.getElementById("naam").style.border = "2px red solid";
                    status = 'fout';
                }
                if (naam !== '') {
                    document.getElementById("error").innerHTML = "";
                    document.getElementById("naam").style.border = "none";
                    status = 'goed';
                }
                if (email === '') {
                    document.getElementById("error").innerHTML = "U heeft niet alles goed ingevuld!";
                    document.getElementById("email").style.border = "2px red solid";
                    status = 'fout';
                }
                if (email !== '') {
                    document.getElementById("error").innerHTML = "";
                    document.getElementById("email").style.border = "none";
                    status = 'goed';
                }
            } else {
                if (status === 'goed') {
                    let cijfer1 = Math.floor(Math.random() * 9) + 1;
                    let cijfer2 = Math.floor(Math.random() * 9) + 1;
                    let cijfer3 = Math.floor(Math.random() * 9) + 1;
                    let cijfer4 = Math.floor(Math.random() * 9) + 1;
                    let cijfer5 = Math.floor(Math.random() * 9) + 1;
                    let cijfer6 = Math.floor(Math.random() * 9) + 1;
                    let code = `${cijfer1}${cijfer2}${cijfer3}${cijfer4}${cijfer5}${cijfer6}`;

                    document.getElementById("naam").style.border = "none";
                    document.getElementById("email").style.border = "none";
                    const toSend = {
                        users: [
                            {
                                uuid: '',
                                owner: "My2N",
                                name: naam,
                                email: email,
                                access: {
                                    validFrom: beginDatum,
                                    validTo: eindDatum,
                                    pin: code
                                }
                            }
                        ]
                    };
                    const url = "https://192.168.33.10/api/dir/create";
                    const jsonString = JSON.stringify(toSend);
                    const xhr = new XMLHttpRequest();
                    
                    xhr.onload = () => {
                        const data = JSON.parse(xhr.responseText);
                        console.log(`response = `, data);
                    }

                    xhr.open("PUT", url);
                    xhr.setRequestHeader('Content-type', 'application/json');
                    xhr.setRequestHeader('Authorization', 'Basic ' + b64);
                    xhr.send(jsonString);
                    document.getElementById("naam").value = "";
                    document.getElementById("email").value = "";
                    document.getElementById("form").innerHTML = "Persoon is toegevoegd";
                    setTimeout(function () {
                        document.getElementById("form").innerHTML = "";
                    }, 5000);
                    document.getElementById("naamTxt").innerHTML = "Naam: " + naam;
                    document.getElementById("emailTxt").innerHTML = "Email: " + email;
                    document.getElementById("codeTxt").innerHTML = "Code: " + code;
                    setTimeout(function () {
                        document.getElementById("naamTxt").innerHTML = "";
                        document.getElementById("emailTxt").innerHTML = "";
                        document.getElementById("codeTxt").innerHTML = "";
                    }, 5000);
                }
            }
        }
        function deleteUsers() {
            //alle users verwijderen
            document.getElementById("naam").style.border = "none";
            document.getElementById("email").style.border = "none";
            document.getElementById("dag").style.border = "none";
            document.getElementById("maand").style.border = "none";
            document.getElementById("jaar").style.border = "none";
            document.getElementById("tijdBeginH").style.border = "";
            document.getElementById("tijdBeginM").style.border = "";
            document.getElementById("tijdEindeH").style.border = "";
            document.getElementById("tijdEindeM").style.border = "";
            document.getElementById("check_delete").style.display = 'block';
            const check_ja = document.getElementById('check_ja');
            const check_nee = document.getElementById('check_nee');

            check_ja.addEventListener('click', function handleClick() {
                document.getElementById("check_delete").style.display = 'none';
                document.getElementById("error").innerHTML = "";
                // Hier staat eigenlijk dat je alle users met de owner 'My2N' pakt en daarna verwijdert
                const toSend = {
                    owner : "My2N"
                };
                // Dit is de api om de users te verwijderen
                const url = "https://192.168.33.10/api/dir/delete";
                const jsonString = JSON.stringify(toSend);
                const xhr = new XMLHttpRequest();
                xhr.open("PUT", url);
                xhr.setRequestHeader('Content-type', 'application/json');
                xhr.setRequestHeader('Authorization', 'Basic ' + b64);
                xhr.send(jsonString);
                    document.getElementById("deleteMSG").innerHTML = "Alle users zijn verwijdert";
                    setTimeout(function () {
                        document.getElementById("deleteMSG").innerHTML = "";
                    }, 2500)
            });
            check_nee.addEventListener('click', function handleClick() {
                document.getElementById("check_delete").style.display = 'none';
            });
        }

        function noodOpen() {
            //nood deur openen.
            if (response2 == 'false'){
            const url = "https://192.168.33.10/api/switch/ctrl?switch=2&action=on";
            const xhr = new XMLHttpRequest();
            xhr.open("GET", url);
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send();
            }else{
                noodDicht();
            }
        }
        function noodDicht() {
            //nood deur dicht doen
            const url = "https://192.168.33.10/api/switch/ctrl?switch=2&action=off";
            const xhr = new XMLHttpRequest();
            xhr.open("GET", url);
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send();
        }
        function deviceInfo() {
            //info over je device
            let e = document.getElementById("box");
            let reset = document.getElementById("reset");
            document.getElementById("box").innerHTML = "<iframe class='info' src='https://192.168.33.10/api/system/info'></iframe>";
            if(e.style.display === 'block') {
                e.style.display = 'none';
                reset.style.display = 'none';
            }
            else{
                e.style.display = 'block';
                reset.style.display = 'inline-block';
            }
        }
        function reset() {
            document.getElementById("box").innerHTML = "<iframe class='info' src='https://192.168.33.10/api/system/info'></iframe>";
        }
        function openDoor() {
            //deur openen voor 3 seconden
            if (response == 'false'){
                const url = "https://192.168.33.10/api/switch/ctrl?switch=1&action=trigger";
                const xhr = new XMLHttpRequest();
                xhr.open("GET", url);
                xhr.setRequestHeader('Authorization', 'Basic '+b64);
                xhr.send();
            }
        }
        function deviceRestart() {
            // Het device opnieuw opstarten
            const url = "https://192.168.33.10/api/system/restart";
            const xhr = new XMLHttpRequest();
            xhr.open("GET", url);
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send();
                document.getElementById("text3").innerHTML = "Uw device is opnieuw opgestart";
                setTimeout(function () {
                    document.getElementById("text3").innerHTML = "";
                }, 3000)
        }
        // Met deze function zoek je alle users op en krijgt dan een JSON response terug met alle users.
        function searchUserName() {
            const url = "https://192.168.33.10/api/dir/query";
            const xhr = new XMLHttpRequest();
            const toSend = {
                 "series": "2966931592397881469", 
                 "fields": [
                    "name",
                    "email", 
                    "callPos.peer",
                    "callPos[1].grouped" 
                ],
                "iterator": { "timestamp": 6 }
            };
            const jsonString = JSON.stringify(toSend);//2966931592397881469
            xhr.onload = () => {
                const data = JSON.parse(xhr.responseText);
                var test = Object.keys(data.result.users).length;
                for (i=0; i < test; i++){
                    response3 = JSON.stringify(data.result.users[i].name);
                    response4 = JSON.stringify(data.result.users[i].uuid);
                    array1.push(response3);
                    array2.push(response4);
                }
                var test = array1.findIndex(checkUser);
                var splitUuid = array2[test];
                if (splitUuid != undefined){
                    userUuid = splitUuid.replace(/"/g, '');
                    returnUserInfo();
                    document.getElementById('noUser').innerHTML = '';
                }else{
                    nameOutput.innerHTML = '';
                    emailOutput.innerHTML = '';
                    pinOutput.innerHTML = '';
                    dateStartOutput.innerHTML= '';
                    dateEndOutput.innerHTML= '';
                    document.getElementById('noUser').innerHTML = 'Gebruiker '+document.getElementById('name').value+' bestaat niet!';
                }
            }
            xhr.open("POST", url);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send(jsonString);
        }
        function checkUser(user){
            return user == '"'+document.getElementById("name").value+'"';

        }
        function deleteSearchUser(){
            document.getElementById('deleteUser').addEventListener('click', function handleClick() {
                if (userUuid == undefined){
                console.log('No uuid!');
                }else{        
                const toSend = {
                "users": [ 
                    { "uuid": userUuid }
                ]
                };
                const url = "https://192.168.33.10/api/dir/delete";
                const jsonString = JSON.stringify(toSend);
                const xhr = new XMLHttpRequest();
                xhr.onload = () => {
                    const data = JSON.parse(xhr.responseText);
                    console.log(`response = `, data);
                }
                xhr.open("PUT", url);
                xhr.setRequestHeader('Content-type', 'application/json');
                xhr.setRequestHeader('Authorization', 'Basic ' + b64);
                xhr.send(jsonString);
                nameOutput.innerHTML = '';
                emailOutput.innerHTML = '';
                pinOutput.innerHTML = '';
                dateStartOutput.innerHTML= '';
                dateEndOutput.innerHTML= '';
                }
            });
        }
        function returnUserInfo(){
            let name,
                email,
                pin,
                dateStart,
                dateEnd;
            const url = "https://192.168.33.10/api/dir/get";
            const xhr = new XMLHttpRequest();
            const toSend = {
                "fields": [
                    "name",
                    "email",
                    "access",
                    "callPos.peer",
                    "callPos[1].grouped"
                    ],
                    "users": [ 
                        { "uuid": userUuid }
                    ]
            };
            const jsonString = JSON.stringify(toSend);
            xhr.onload = () => {
                const data = JSON.parse(xhr.responseText);
                name = data.result.users[0].name;
                email = data.result.users[0].email;
                pin = data.result.users[0].access.pin;

                var date1 = new Date(data.result.users[0].access.validFrom * 1000);
                date1.setMonth(date1.getMonth() + 1);
                if(date1.getFullYear() == 2023)date1.setHours(date1.getHours() - 2);
                else date1.setHours(date1.getHours() -1);

                var date2 = new Date(data.result.users[0].access.validTo * 1000);
                if(date2.getFullYear() == 2023)date2.setHours(date2.getHours() - 2);
                else date2.setHours(date2.getHours() -1);

                dateStart = date1.getDate()+'-'+date1.getMonth()+'-'+date1.getFullYear()+' / '+date1.getHours()+':'+date1.getMinutes();
                dateEnd = date2.getDate()+'-'+date2.getMonth()+'-'+date2.getFullYear()+' / '+date2.getHours()+':'+date2.getMinutes();
                nameOutput.innerHTML = 'Naam: '+name;
                emailOutput.innerHTML = 'Email: '+email;
                pinOutput.innerHTML = 'Pin: '+pin;
                dateStartOutput.innerHTML= 'Start datum: '+dateStart;
                dateEndOutput.innerHTML= 'Eind datum: '+dateEnd;
            }
            xhr.open("POST", url);
            xhr.setRequestHeader('Content-type', 'application/json');
            xhr.setRequestHeader('Authorization', 'Basic '+b64);
            xhr.send(jsonString);
        }
    </script>
    </center>
</body>
</html>